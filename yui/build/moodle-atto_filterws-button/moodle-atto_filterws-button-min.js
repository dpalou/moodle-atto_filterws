YUI.add("moodle-atto_filterws-button",function(e,t){var n="atto_filterws",r=[{name:"web",str:"originweb",value:"web"},{name:"ws",str:"originws",value:"ws"},{name:"any",str:"originany",value:"any"}],i={FORM:"atto_filterws_form",INPUTORIGIN:"atto_filterws_origin",INPUTUSERAGENT:"atto_filterws_useragent",INPUTSUBMIT:"atto_filterws_submit",FILTERUSERAGENT:"atto_filterws_filteruseragent"},s='<form class="atto_form {{CSS.FORM}}"><div class="form-inline m-b-1"><label class="for="{{elementid}}_{{CSS.INPUTORIGIN}}">{{get_string "origin" component}} {{{helpStrings.origin}}}</label><select class="custom-select {{CSS.INPUTORIGIN}}" id="{{elementid}}_{{CSS.INPUTORIGIN}}">{{#each origins}}<option value="{{value}}">{{get_string str ../component}}</option>{{/each}}</select></div><div class="m-b-1"><label for="{{elementid}}_{{CSS.INPUTUSERAGENT}}">{{get_string "filteruseragent" component}} {{{helpStrings.filteruseragent}}}</label><input class="form-control fullwidth {{CSS.INPUTUSERAGENT}}" type="text" value="" id="{{elementid}}_{{CSS.INPUTUSERAGENT}}" size="32"/></div><button class="btn btn-default {{CSS.INPUTSUBMIT}}" type="submit">{{get_string "insert" component}}</button></form>';e.namespace("M.atto_filterws").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,initializer:function(){this.addButton({icon:"icon",iconComponent:"atto_filterws",title:"addfilterws",buttonName:"addfilterws",callback:this._displayDialogue})},_displayDialogue:function(){this._currentSelection=this.get("host").getSelection()[0];if(!this._currentSelection)return;var e=this.getDialogue({headerContent:M.util.get_string("insertfilterws",n),focusAfterHide:!0},!0);e.set("bodyContent",this._getDialogueContent()).show()},_getDialogueContent:function(){var t=e.Handlebars.compile(s),o=e.Node.create(t({elementid:this.get("host").get("elementid"),CSS:i,component:n,origins:r,helpStrings:this.get("help")}));return this._form=o,this._form.one("."+i.INPUTSUBMIT).on("click",this._addFilterTag,this),o},_addFilterTag:function(e){e.preventDefault();var t=this._form,n=t.one("."+i.INPUTORIGIN).get("value"),r=t.one("."+i.INPUTUSERAGENT).get("value"),s=this._currentSelection,o=null;if(s){var u=this._getTextElement(s.endContainer,s.endOffset),a=this._getTextElement(s.startContainer,s.startOffset);if(a&&u){if(a===u&&s.startOffset===0&&s.endOffset===a.data.length){var f=this._searchParentToWrap(a);if(f!=a&&f.parentNode){var l=f.parentNode,c=Array.from(l.childNodes).indexOf(f);if(c!=-1){a=document.createTextNode(""),u=document.createTextNode("");var h=l.childNodes[c+1];h?l.insertBefore(u,h):l.appendChild(u),l.insertBefore(a,f)}}}var p=u===s.endContainer?s.endOffset:0;u.data=u.data.substring(0,p)+"{fws}"+u.data.substring(p),p=a===s.startContainer?s.startOffset:0;var d="{fws "+n+(r?' ua="'+r+'"':"")+"}";a.data=a.data.substring(0,p)+d+a.data.substring(p),s.startContainer.nodeType==Node.TEXT_NODE?o=s.startContainer.parentElement:o=s.startContainer}else window.console.warn("Could not find the right elements to insert the fws tag.");this.markUpdated()}else window.console.warn("Could not find a selection to insert the fws tag.");this.getDialogue({focusAfterHide:o}).hide()},_getTextElement:function(e,t){var n;if(e.nodeType==Node.TEXT_NODE)return e;if(e.childNodes){if(t>=e.childNodes.length)return n=document.createTextNode(""),e.appendChild(n),n;var r=e.childNodes[t];return r.nodeType==Node.TEXT_NODE?r:(n=document.createTextNode(""),e.insertBefore(n,r),n)}},_searchParentToWrap:function(e){var t=e.parentNode;return t&&t.childNodes&&t.childNodes.length===1?this._searchParentToWrap(t):e}},{ATTRS:{help:{}}})},"@VERSION@",{requires:[]});
